(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.jiboProgrammingChallenge = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
/// <reference path="../typings/index.d.ts" />
var PIXI = require('pixi.js');
//import audio = require('pixi-sound');
// global vars
// system
var renderer = new PIXI.WebGLRenderer(3000, 3000);
var stage = new PIXI.Container();
// game constants
var HELP_OFFSET_X = 10;
var HELP_OFFSET_Y = 10;
var BOARD_OFFSET_X = 10;
var BOARD_OFFSET_Y = 70;
var BOARD_PADDING_X = 4;
var BOARD_PADDING_Y = 4;
var FRAME_SPEED = 100;
// game resources
var resources;
var fontStyle;
var arrowTextures = [];
var helpText;
// game state
var boardSize = 10;
var board = [];
var coin;
var coinTrail = [];
var frameTime = 0;
function initialize() {
    // System
    document.body.appendChild(renderer.view);
    // Textures
    PIXI.loader
        .add('tile1', 'images/tile_blue.png')
        .add('tile2', 'images/tile_red.png')
        .add('arrow_up', 'images/arrow_up.png')
        .add('arrow_right', 'images/arrow_right.png')
        .add('arrow_down', 'images/arrow_down.png')
        .add('arrow_left', 'images/arrow_left.png')
        .add('coin', 'images/coin.png')
        .load(function (loader, newResources) {
        resources = newResources;
        arrowTextures[0] = resources.arrow_up.texture;
        arrowTextures[1] = resources.arrow_right.texture;
        arrowTextures[2] = resources.arrow_down.texture;
        arrowTextures[3] = resources.arrow_left.texture;
        generateUi();
        generateBoard();
        generateCoin();
        runAnimation(0);
    });
}
function generateUi() {
    // Setup style
    fontStyle = new PIXI.TextStyle({
        fontFamily: 'Arial',
        fontSize: 20,
        fill: 'white'
    });
    // Setup help text
    helpText = new PIXI.Text("Click on a tile to drop a coin.\nSee how long you can get it to stay before falling off the board.", fontStyle);
    helpText.x = HELP_OFFSET_X;
    helpText.y = HELP_OFFSET_Y;
    stage.addChild(helpText);
}
function generateBoard() {
    // Setup sprites
    for (var y = 0; y < boardSize; ++y) {
        board[y] = [];
        for (var x = 0; x < boardSize; ++x) {
            var tileTexture = ((x + y) % 2 == 0) ? resources.tile1.texture : resources.tile2.texture;
            var positionX = x * (64 + BOARD_PADDING_X) + BOARD_OFFSET_X;
            var positionY = y * (64 + BOARD_PADDING_Y) + BOARD_OFFSET_Y;
            board[y][x] = new PIXI.Sprite(tileTexture);
            var tile = board[y][x];
            tile.position.x = positionX;
            tile.position.y = positionY;
            tile.arrow = new PIXI.Sprite(arrowTextures[2]);
            tile.arrowType = 2;
            tile.addChild(tile.arrow);
            tile.interactive = true;
            tile.buttonMode = true;
            tile.on('mouseup', onBoardClick);
            stage.addChild(tile);
        }
    }
    // Setup neighbor links
    for (var y = 0; y < boardSize; ++y) {
        for (var x = 0; x < boardSize; ++x) {
            var tile = board[y][x];
            tile.neighbor = [];
            if (y > 0) {
                tile.neighbor[0] = board[y - 1][x];
            }
            if (x < boardSize - 1) {
                tile.neighbor[1] = board[y][x + 1];
            }
            if (y < boardSize - 1) {
                tile.neighbor[2] = board[y + 1][x];
            }
            if (x > 0) {
                tile.neighbor[3] = board[y][x - 1];
            }
        }
    }
    randomizeBoard();
}
function generateCoin() {
    coin = new PIXI.Sprite(resources.coin.texture);
    coin.visible = false;
    stage.addChild(coin);
}
function randomizeBoard() {
    for (var y = 0; y < boardSize; ++y) {
        for (var x = 0; x < boardSize; ++x) {
            var type = Math.floor(Math.random() * 4);
            board[y][x].arrow.texture = arrowTextures[type];
            board[y][x].arrowType = type;
        }
    }
}
function onBoardClick(event) {
    var tile = event.target;
    coin.tile = tile;
    coin.position = tile.position;
    coin.visible = true;
}
function runFrameLogic() {
    if (coin.visible) {
        var tile = coin.tile;
        // add trail
        var newCoinTrail = new PIXI.Sprite(resources.coin.texture);
        coinTrail.push(newCoinTrail);
        newCoinTrail.position = coin.position;
        newCoinTrail["tile"] = coin.tile;
        newCoinTrail.alpha = .5;
        stage.addChild(newCoinTrail);
        // move coin
        tile = tile.neighbor[tile.arrowType];
        if (tile) {
            coin.tile = tile;
            coin.position = tile.position;
        }
        // remove coin
        var isOnCoinTrail = false;
        for (var i = 0; i < coinTrail.length; ++i) {
            if (coinTrail[i].tile == coin.tile) {
                isOnCoinTrail = true;
                break;
            }
        }
        if (!tile || isOnCoinTrail) {
            coin.visible = false;
            while (coinTrail.length > 0) {
                var coinTrailItem = coinTrail.pop();
                stage.removeChild(coinTrailItem);
                coinTrailItem.destroy();
            }
        }
    }
}
function runAnimation(timeStamp) {
    if (timeStamp - frameTime > FRAME_SPEED) {
        frameTime = timeStamp;
        runFrameLogic();
    }
    requestAnimationFrame(runAnimation);
    renderer.render(stage);
}
initialize();
},{"pixi.js":undefined}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy93YXRjaGlmeS9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwic3JjL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQ0FBLDhDQUE4QztBQUM5QyxJQUFPLElBQUksV0FBVyxTQUFTLENBQUMsQ0FBQztBQUNqQyx1Q0FBdUM7QUFFdkMsY0FBYztBQUNWLFNBQVM7QUFDVCxJQUFNLFFBQVEsR0FBc0IsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztBQUN2RSxJQUFNLEtBQUssR0FBa0IsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7QUFDbEQsaUJBQWlCO0FBQ2pCLElBQU0sYUFBYSxHQUFHLEVBQUUsQ0FBQztBQUN6QixJQUFNLGFBQWEsR0FBRyxFQUFFLENBQUM7QUFDekIsSUFBTSxjQUFjLEdBQUcsRUFBRSxDQUFDO0FBQzFCLElBQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQztBQUMxQixJQUFNLGVBQWUsR0FBRyxDQUFDLENBQUM7QUFDMUIsSUFBTSxlQUFlLEdBQUcsQ0FBQyxDQUFDO0FBQzFCLElBQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQztBQUN4QixpQkFBaUI7QUFDakIsSUFBSSxTQUFhLENBQUM7QUFDbEIsSUFBSSxTQUFTLENBQUM7QUFDZCxJQUFJLGFBQWEsR0FBRyxFQUFFLENBQUM7QUFDdkIsSUFBSSxRQUFRLENBQUM7QUFDYixhQUFhO0FBQ2IsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ25CLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztBQUNmLElBQUksSUFBSSxDQUFDO0FBQ1QsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ25CLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQztBQUN0QjtJQUNJLFNBQVM7SUFDVCxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxR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ZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxyXG5pbXBvcnQgUElYSSA9IHJlcXVpcmUoJ3BpeGkuanMnKTtcclxuLy9pbXBvcnQgYXVkaW8gPSByZXF1aXJlKCdwaXhpLXNvdW5kJyk7XHJcblxyXG4vLyBnbG9iYWwgdmFyc1xyXG4gICAgLy8gc3lzdGVtXHJcbiAgICBjb25zdCByZW5kZXJlcjpQSVhJLldlYkdMUmVuZGVyZXIgPSBuZXcgUElYSS5XZWJHTFJlbmRlcmVyKDMwMDAsIDMwMDApO1xyXG4gICAgY29uc3Qgc3RhZ2U6UElYSS5Db250YWluZXIgPSBuZXcgUElYSS5Db250YWluZXIoKTtcclxuICAgIC8vIGdhbWUgY29uc3RhbnRzXHJcbiAgICBjb25zdCBIRUxQX09GRlNFVF9YID0gMTA7XHJcbiAgICBjb25zdCBIRUxQX09GRlNFVF9ZID0gMTA7XHJcbiAgICBjb25zdCBCT0FSRF9PRkZTRVRfWCA9IDEwO1xyXG4gICAgY29uc3QgQk9BUkRfT0ZGU0VUX1kgPSA3MDtcclxuICAgIGNvbnN0IEJPQVJEX1BBRERJTkdfWCA9IDQ7XHJcbiAgICBjb25zdCBCT0FSRF9QQURESU5HX1kgPSA0O1xyXG4gICAgY29uc3QgRlJBTUVfU1BFRUQgPSAxMDA7XHJcbiAgICAvLyBnYW1lIHJlc291cmNlc1xyXG4gICAgbGV0IHJlc291cmNlczphbnk7XHJcbiAgICB2YXIgZm9udFN0eWxlO1xyXG4gICAgdmFyIGFycm93VGV4dHVyZXMgPSBbXTtcclxuICAgIHZhciBoZWxwVGV4dDtcclxuICAgIC8vIGdhbWUgc3RhdGVcclxuICAgIHZhciBib2FyZFNpemUgPSAxMDtcclxuICAgIHZhciBib2FyZCA9IFtdO1xyXG4gICAgdmFyIGNvaW47XHJcbiAgICB2YXIgY29pblRyYWlsID0gW107XHJcbiAgICB2YXIgZnJhbWVUaW1lID0gMDtcclxuZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcclxuICAgIC8vIFN5c3RlbVxyXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci52aWV3KTtcclxuICAgIC8vIFRleHR1cmVzXHJcbiAgICBQSVhJLmxvYWRlclxyXG4gICAgICAgIC5hZGQoJ3RpbGUxJywgJ2ltYWdlcy90aWxlX2JsdWUucG5nJylcclxuICAgICAgICAuYWRkKCd0aWxlMicsICdpbWFnZXMvdGlsZV9yZWQucG5nJylcclxuICAgICAgICAuYWRkKCdhcnJvd191cCcsICdpbWFnZXMvYXJyb3dfdXAucG5nJylcclxuICAgICAgICAuYWRkKCdhcnJvd19yaWdodCcsICdpbWFnZXMvYXJyb3dfcmlnaHQucG5nJylcclxuICAgICAgICAuYWRkKCdhcnJvd19kb3duJywgJ2ltYWdlcy9hcnJvd19kb3duLnBuZycpXHJcbiAgICAgICAgLmFkZCgnYXJyb3dfbGVmdCcsICdpbWFnZXMvYXJyb3dfbGVmdC5wbmcnKVxyXG4gICAgICAgIC5hZGQoJ2NvaW4nLCAgICAnaW1hZ2VzL2NvaW4ucG5nJylcclxuICAgICAgICAubG9hZChmdW5jdGlvbiAobG9hZGVyOlBJWEkubG9hZGVycy5Mb2FkZXIsIG5ld1Jlc291cmNlczphbnkpIHtcclxuICAgICAgICAgICAgcmVzb3VyY2VzID0gbmV3UmVzb3VyY2VzO1xyXG4gICAgICAgICAgICBhcnJvd1RleHR1cmVzWzBdID0gcmVzb3VyY2VzLmFycm93X3VwLnRleHR1cmU7XHJcbiAgICAgICAgICAgIGFycm93VGV4dHVyZXNbMV0gPSByZXNvdXJjZXMuYXJyb3dfcmlnaHQudGV4dHVyZTtcclxuICAgICAgICAgICAgYXJyb3dUZXh0dXJlc1syXSA9IHJlc291cmNlcy5hcnJvd19kb3duLnRleHR1cmU7XHJcbiAgICAgICAgICAgIGFycm93VGV4dHVyZXNbM10gPSByZXNvdXJjZXMuYXJyb3dfbGVmdC50ZXh0dXJlO1xyXG4gICAgICAgICAgICBnZW5lcmF0ZVVpKCk7XHJcbiAgICAgICAgICAgIGdlbmVyYXRlQm9hcmQoKTtcclxuICAgICAgICAgICAgZ2VuZXJhdGVDb2luKCk7XHJcbiAgICAgICAgICAgIHJ1bkFuaW1hdGlvbigwKTtcclxuICAgICAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVVaSgpIHtcclxuICAgIC8vIFNldHVwIHN0eWxlXHJcbiAgICBmb250U3R5bGUgPSBuZXcgUElYSS5UZXh0U3R5bGUoe1xyXG4gICAgICAgIGZvbnRGYW1pbHk6ICdBcmlhbCcsXHJcbiAgICAgICAgZm9udFNpemU6IDIwLFxyXG4gICAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICB9KTtcclxuICAgIC8vIFNldHVwIGhlbHAgdGV4dFxyXG4gICAgaGVscFRleHQgPSBuZXcgUElYSS5UZXh0KFwiQ2xpY2sgb24gYSB0aWxlIHRvIGRyb3AgYSBjb2luLlxcblNlZSBob3cgbG9uZyB5b3UgY2FuIGdldCBpdCB0byBzdGF5IGJlZm9yZSBmYWxsaW5nIG9mZiB0aGUgYm9hcmQuXCIsIGZvbnRTdHlsZSk7XHJcbiAgICBoZWxwVGV4dC54ID0gSEVMUF9PRkZTRVRfWDtcclxuICAgIGhlbHBUZXh0LnkgPSBIRUxQX09GRlNFVF9ZO1xyXG4gICAgc3RhZ2UuYWRkQ2hpbGQoaGVscFRleHQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZW5lcmF0ZUJvYXJkKCkge1xyXG4gICAgLy8gU2V0dXAgc3ByaXRlc1xyXG4gICAgZm9yICh2YXIgeSA9IDA7IHkgPCBib2FyZFNpemU7ICsreSkge1xyXG4gICAgICAgIGJvYXJkW3ldID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBib2FyZFNpemU7ICsreCkge1xyXG4gICAgICAgICAgICB2YXIgdGlsZVRleHR1cmUgPSAoKHggKyB5KSAlIDIgPT0gMCkgPyByZXNvdXJjZXMudGlsZTEudGV4dHVyZSA6IHJlc291cmNlcy50aWxlMi50ZXh0dXJlO1xyXG4gICAgICAgICAgICB2YXIgcG9zaXRpb25YID0geCAqICg2NCArIEJPQVJEX1BBRERJTkdfWCkgKyBCT0FSRF9PRkZTRVRfWDtcclxuICAgICAgICAgICAgdmFyIHBvc2l0aW9uWSA9IHkgKiAoNjQgKyBCT0FSRF9QQURESU5HX1kpICsgQk9BUkRfT0ZGU0VUX1k7XHJcbiAgICAgICAgICAgIGJvYXJkW3ldW3hdID0gbmV3IFBJWEkuU3ByaXRlKHRpbGVUZXh0dXJlKTtcclxuICAgICAgICAgICAgdmFyIHRpbGUgPSBib2FyZFt5XVt4XTtcclxuICAgICAgICAgICAgdGlsZS5wb3NpdGlvbi54ID0gcG9zaXRpb25YO1xyXG4gICAgICAgICAgICB0aWxlLnBvc2l0aW9uLnkgPSBwb3NpdGlvblk7XHJcbiAgICAgICAgICAgIHRpbGUuYXJyb3cgPSBuZXcgUElYSS5TcHJpdGUoYXJyb3dUZXh0dXJlc1syXSk7XHJcbiAgICAgICAgICAgIHRpbGUuYXJyb3dUeXBlID0gMjtcclxuICAgICAgICAgICAgdGlsZS5hZGRDaGlsZCh0aWxlLmFycm93KTtcclxuICAgICAgICAgICAgdGlsZS5pbnRlcmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRpbGUuYnV0dG9uTW9kZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRpbGUub24oJ21vdXNldXAnLCBvbkJvYXJkQ2xpY2spO1xyXG4gICAgICAgICAgICBzdGFnZS5hZGRDaGlsZCh0aWxlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBTZXR1cCBuZWlnaGJvciBsaW5rc1xyXG4gICAgZm9yICh2YXIgeSA9IDA7IHkgPCBib2FyZFNpemU7ICsreSkge1xyXG4gICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgYm9hcmRTaXplOyArK3gpIHtcclxuICAgICAgICAgICAgdmFyIHRpbGUgPSBib2FyZFt5XVt4XTtcclxuICAgICAgICAgICAgdGlsZS5uZWlnaGJvciA9IFtdO1xyXG4gICAgICAgICAgICBpZiAoeSA+IDApICAgICAgICAgICB7IHRpbGUubmVpZ2hib3JbMF0gPSBib2FyZFt5LTFdW3hdOyB9XHJcbiAgICAgICAgICAgIGlmICh4IDwgYm9hcmRTaXplLTEpIHsgdGlsZS5uZWlnaGJvclsxXSA9IGJvYXJkW3ldW3grMV07IH1cclxuICAgICAgICAgICAgaWYgKHkgPCBib2FyZFNpemUtMSkgeyB0aWxlLm5laWdoYm9yWzJdID0gYm9hcmRbeSsxXVt4XTsgfVxyXG4gICAgICAgICAgICBpZiAoeCA+IDApICAgICAgICAgICB7IHRpbGUubmVpZ2hib3JbM10gPSBib2FyZFt5XVt4LTFdOyB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmFuZG9taXplQm9hcmQoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVDb2luKCkge1xyXG4gICAgY29pbiA9IG5ldyBQSVhJLlNwcml0ZShyZXNvdXJjZXMuY29pbi50ZXh0dXJlKTtcclxuICAgIGNvaW4udmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgc3RhZ2UuYWRkQ2hpbGQoY29pbik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJhbmRvbWl6ZUJvYXJkKCkge1xyXG4gICAgZm9yICh2YXIgeSA9IDA7IHkgPCBib2FyZFNpemU7ICsreSkge1xyXG4gICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgYm9hcmRTaXplOyArK3gpIHtcclxuICAgICAgICAgICAgdmFyIHR5cGUgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KTtcclxuICAgICAgICAgICAgYm9hcmRbeV1beF0uYXJyb3cudGV4dHVyZSA9IGFycm93VGV4dHVyZXNbdHlwZV07XHJcbiAgICAgICAgICAgIGJvYXJkW3ldW3hdLmFycm93VHlwZSA9IHR5cGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBvbkJvYXJkQ2xpY2soZXZlbnQpIHtcclxuICAgIHZhciB0aWxlID0gZXZlbnQudGFyZ2V0O1xyXG4gICAgY29pbi50aWxlID0gdGlsZTtcclxuICAgIGNvaW4ucG9zaXRpb24gPSB0aWxlLnBvc2l0aW9uO1xyXG4gICAgY29pbi52aXNpYmxlID0gdHJ1ZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcnVuRnJhbWVMb2dpYygpIHtcclxuICAgIGlmIChjb2luLnZpc2libGUpIHtcclxuICAgICAgICB2YXIgdGlsZSA9IGNvaW4udGlsZTtcclxuICAgICAgICAvLyBhZGQgdHJhaWxcclxuICAgICAgICB2YXIgbmV3Q29pblRyYWlsID0gbmV3IFBJWEkuU3ByaXRlKHJlc291cmNlcy5jb2luLnRleHR1cmUpO1xyXG4gICAgICAgIGNvaW5UcmFpbC5wdXNoKG5ld0NvaW5UcmFpbCk7XHJcbiAgICAgICAgbmV3Q29pblRyYWlsLnBvc2l0aW9uID0gY29pbi5wb3NpdGlvbjtcclxuICAgICAgICBuZXdDb2luVHJhaWxbXCJ0aWxlXCJdID0gY29pbi50aWxlO1xyXG4gICAgICAgIG5ld0NvaW5UcmFpbC5hbHBoYSA9IC41O1xyXG4gICAgICAgIHN0YWdlLmFkZENoaWxkKG5ld0NvaW5UcmFpbCk7XHJcbiAgICAgICAgLy8gbW92ZSBjb2luXHJcbiAgICAgICAgdGlsZSA9IHRpbGUubmVpZ2hib3JbdGlsZS5hcnJvd1R5cGVdO1xyXG4gICAgICAgIGlmICh0aWxlKSB7XHJcbiAgICAgICAgICAgIGNvaW4udGlsZSA9IHRpbGU7XHJcbiAgICAgICAgICAgIGNvaW4ucG9zaXRpb24gPSB0aWxlLnBvc2l0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyByZW1vdmUgY29pblxyXG4gICAgICAgIHZhciBpc09uQ29pblRyYWlsID0gZmFsc2U7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2luVHJhaWwubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgaWYgKGNvaW5UcmFpbFtpXS50aWxlID09IGNvaW4udGlsZSkge1xyXG4gICAgICAgICAgICAgICAgaXNPbkNvaW5UcmFpbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRpbGUgfHwgaXNPbkNvaW5UcmFpbCkge1xyXG4gICAgICAgICAgICBjb2luLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgd2hpbGUgKGNvaW5UcmFpbC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29pblRyYWlsSXRlbSA9IGNvaW5UcmFpbC5wb3AoKTtcclxuICAgICAgICAgICAgICAgIHN0YWdlLnJlbW92ZUNoaWxkKGNvaW5UcmFpbEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgY29pblRyYWlsSXRlbS5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJ1bkFuaW1hdGlvbih0aW1lU3RhbXApIHtcclxuICAgIGlmICh0aW1lU3RhbXAtZnJhbWVUaW1lID4gRlJBTUVfU1BFRUQpIHtcclxuICAgICAgICBmcmFtZVRpbWUgPSB0aW1lU3RhbXA7XHJcbiAgICAgICAgcnVuRnJhbWVMb2dpYygpO1xyXG4gICAgfVxyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJ1bkFuaW1hdGlvbik7XHJcbiAgICByZW5kZXJlci5yZW5kZXIoc3RhZ2UpO1xyXG59XHJcblxyXG5pbml0aWFsaXplKCk7XHJcbiJdfQ==
