(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.jiboProgrammingChallenge = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
/// <reference path="../typings/index.d.ts" />
var PIXI = require('pixi.js');
//import audio = require('pixi-sound');
// global vars
// system
var renderer = new PIXI.WebGLRenderer(3000, 3000);
var stage = new PIXI.Container();
// game constants
var HELP_OFFSET_X = 10;
var HELP_OFFSET_Y = 10;
var BOARD_OFFSET_X = 10;
var BOARD_OFFSET_Y = 70;
var BOARD_PADDING_X = 4;
var BOARD_PADDING_Y = 4;
var FRAME_SPEED = 200;
// game resources
var resources;
var fontStyle;
var arrowTextures;
var explosionTextures;
var helpText;
// game state
var boardSize = 10;
var board = [];
var coin;
var explosion;
var coinTrail = [];
var frameTime = 0;
function initialize() {
    // System
    document.body.appendChild(renderer.view);
    // Textures
    PIXI.loader
        .add('tile1', 'images/tile_blue.png')
        .add('tile2', 'images/tile_green.png')
        .add('arrow_up', 'images/arrow_up.png')
        .add('arrow_right', 'images/arrow_right.png')
        .add('arrow_down', 'images/arrow_down.png')
        .add('arrow_left', 'images/arrow_left.png')
        .add('explosion_1', 'images/explosion_1.png')
        .add('explosion_2', 'images/explosion_2.png')
        .add('explosion_3', 'images/explosion_3.png')
        .add('explosion_4', 'images/explosion_4.png')
        .add('explosion_5', 'images/explosion_5.png')
        .add('coin', 'images/coin.png')
        .load(function (loader, newResources) {
        resources = newResources;
        setupTextureResources();
        setupUi();
        setupBoard();
        setupCoinAndExplosion();
        runAnimation(0);
    });
}
function setupTextureResources() {
    arrowTextures = [];
    arrowTextures[0] = resources.arrow_up.texture;
    arrowTextures[1] = resources.arrow_right.texture;
    arrowTextures[2] = resources.arrow_down.texture;
    arrowTextures[3] = resources.arrow_left.texture;
    explosionTextures = [];
    explosionTextures[0] = resources.explosion_1.texture;
    explosionTextures[1] = resources.explosion_2.texture;
    explosionTextures[2] = resources.explosion_3.texture;
    explosionTextures[3] = resources.explosion_4.texture;
    explosionTextures[4] = resources.explosion_5.texture;
}
function setupUi() {
    // Setup style
    fontStyle = new PIXI.TextStyle({
        fontFamily: 'Arial',
        fontSize: 20,
        fill: 'white'
    });
    // Setup help text
    helpText = new PIXI.Text("Click on a tile to drop a coin.\nSee quickly you can find the paths off of the board.", fontStyle);
    helpText.x = HELP_OFFSET_X;
    helpText.y = HELP_OFFSET_Y;
    stage.addChild(helpText);
}
function setupBoard() {
    // Setup board sprites
    for (var y = 0; y < boardSize; ++y) {
        board[y] = [];
        for (var x = 0; x < boardSize; ++x) {
            // tile
            var tileTexture = ((x + y) % 2 == 0) ? resources.tile1.texture : resources.tile2.texture;
            var positionX = x * (64 + BOARD_PADDING_X) + BOARD_OFFSET_X;
            var positionY = y * (64 + BOARD_PADDING_Y) + BOARD_OFFSET_Y;
            board[y][x] = new PIXI.Sprite(tileTexture);
            var tile = board[y][x];
            tile.position.x = positionX;
            tile.position.y = positionY;
            stage.addChild(tile);
            // arrow
            tile.arrow = new PIXI.Sprite(arrowTextures[2]);
            tile.arrowType = 2;
            tile.addChild(tile.arrow);
            // mouse clicks
            tile.interactive = true;
            tile.buttonMode = true;
            tile.on('mouseup', onBoardClick);
        }
    }
    // Setup neighbor links
    for (var y = 0; y < boardSize; ++y) {
        for (var x = 0; x < boardSize; ++x) {
            var tile = board[y][x];
            tile.neighbor = [];
            if (y > 0) {
                tile.neighbor[0] = board[y - 1][x];
            }
            if (x < boardSize - 1) {
                tile.neighbor[1] = board[y][x + 1];
            }
            if (y < boardSize - 1) {
                tile.neighbor[2] = board[y + 1][x];
            }
            if (x > 0) {
                tile.neighbor[3] = board[y][x - 1];
            }
        }
    }
    randomizeBoard();
}
function setupCoinAndExplosion() {
    coin = new PIXI.Sprite(resources.coin.texture);
    coin.visible = false;
    stage.addChild(coin);
    explosion = new PIXI.Sprite(explosionTextures[0]);
    explosion.frame = -1;
    explosion.visible = false;
    stage.addChild(explosion);
}
function randomizeBoard() {
    for (var y = 0; y < boardSize; ++y) {
        for (var x = 0; x < boardSize; ++x) {
            var type = Math.floor(Math.random() * 4);
            board[y][x].arrow.texture = arrowTextures[type];
            board[y][x].arrowType = type;
        }
    }
}
function onBoardClick(event) {
    var tile = event.target;
    // remove the explosion (if still visible)
    explosion.visible = false;
    // place the coin
    coin.tile = tile;
    coin.position = tile.position;
    coin.visible = true;
}
function runFrameLogic() {
    if (coin.visible && !explosion.visible) {
        var tile = coin.tile;
        // add trail
        var newCoinTrail = new PIXI.Sprite(resources.coin.texture);
        coinTrail.push(newCoinTrail);
        newCoinTrail.position = coin.position;
        newCoinTrail["tile"] = coin.tile;
        newCoinTrail.alpha = .5;
        stage.addChild(newCoinTrail);
        // Get new position
        var newTile = tile.neighbor[tile.arrowType];
        // Check for trail loop
        if (newTile) {
            for (var i = 0; i < coinTrail.length; ++i) {
                if (coinTrail[i].tile == newTile) {
                    explosion.visible = true;
                    break;
                }
            }
        }
        // Remove coin (if applicable)
        if (!newTile || explosion.visible) {
            while (coinTrail.length > 0) {
                var coinTrailItem = coinTrail.pop();
                stage.removeChild(coinTrailItem);
                coinTrailItem.destroy();
            }
            if (!explosion.visible) {
                coin.visible = false;
            }
        }
        else {
            coin.tile = newTile;
            coin.position = newTile.position;
        }
    }
    if (explosion.visible) {
        ++explosion.frame;
        // special frames
        if (explosion.frame == 0) {
            explosion.position = coin.position;
        }
        else if (explosion.frame == 1) {
            coin.visible = false;
        }
        // Draw or remove
        if (explosion.frame == 5) {
            explosion.visible = false;
            explosion.frame = -1;
        }
        else {
            explosion.texture = explosionTextures[explosion.frame];
        }
    }
}
function runAnimation(timeStamp) {
    // call "runFrameLogic()" at FRAME_SPEED intervals
    if (timeStamp - frameTime > FRAME_SPEED) {
        frameTime = timeStamp;
        runFrameLogic();
    }
    // Render and loop
    renderer.render(stage);
    requestAnimationFrame(runAnimation);
}
initialize();
},{"pixi.js":undefined}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy93YXRjaGlmeS9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwic3JjL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQ0NBLDhDQUE4QztBQUM5QyxJQUFPLElBQUksV0FBVyxTQUFTLENBQUMsQ0FBQztBQUNqQyx1Q0FBdUM7QUFHdkMsY0FBYztBQUNWLFNBQVM7QUFDVCxJQUFNLFFBQVEsR0FBc0IsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztBQUN2RSxJQUFNLEtBQUssR0FBa0IsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7QUFDbEQsaUJBQWlCO0FBQ2pCLElBQU0sYUFBYSxHQUFHLEVBQUUsQ0FBQztBQUN6QixJQUFNLGFBQWEsR0FBRyxFQUFFLENBQUM7QUFDekIsSUFBTSxjQUFjLEdBQUcsRUFBRSxDQUFDO0FBQzFCLElBQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQztBQUMxQixJQUFNLGVBQWUsR0FBRyxDQUFDLENBQUM7QUFDMUIsSUFBTSxlQUFlLEdBQUcsQ0FBQyxDQUFDO0FBQzFCLElBQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQztBQUN4QixpQkFBaUI7QUFDakIsSUFBSSxTQUFhLENBQUM7QUFDbEIsSUFBSSxTQUFTLENBQUM7QUFDZCxJQUFJLGFBQWEsQ0FBQztBQUNsQixJQUFJLGlCQUFpQixDQUFDO0FBQ3RCLElBQUksUUFBUSxDQUFDO0FBQ2IsYUFBYTtBQUNiLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztBQUNuQixJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7QUFDZixJQUFJLElBQUksQ0FBQztBQUNULElBQUksU0FBUyxDQUFDO0FBQ2QsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ25CLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQztBQUd0QjtJQUNJLFNBQVM7SUFD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WUFDMUIsZUFBZTtZQUNmLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3JDLENBQUM7SUFDTCxDQUFDO0lBQ0QsdUJBQXVCO0lBQ3ZCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDakMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNqQyxJQUFJLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkIsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7WUFDbkIsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFXLENBQUM7Z0JBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQUMsQ0FBQztZQUMxRCxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsU0FBUyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxDQUFDO1lBQUMsQ0FBQztZQUMxRCxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsU0FBUyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFD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LEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLFNBQVMsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNyQyxDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNoQyxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztRQUN2QixDQUFDO1FBQ0QsaUJBQWlCO1FBQ2pCLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2QixTQUFTLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztZQUMxQixTQUFTLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLFNBQVMsQ0FBQyxPQUFPLEdBQUcsaUJBQWlCLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNELENBQUM7SUFDTCxDQUFDO0FBQ0wsQ0FBQztBQUVELHNCQUFzQixTQUFTO0lBQzNCLGtEQUFrRDtJQUNsRCxFQUFFLENBQUMsQ0FBQyxTQUFTLEdBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUM7UUFDcEMsU0FBUyxHQUFHLFNBQVMsQ0FBQztRQUN0QixhQUFhLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBQ0Qsa0JBQWtCO0lBQ2xCLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkIscUJBQXFCLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDeEMsQ0FBQztBQUVELFVBQVUsRUFBRSxDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuaW1wb3J0IFBJWEkgPSByZXF1aXJlKCdwaXhpLmpzJyk7XHJcbi8vaW1wb3J0IGF1ZGlvID0gcmVxdWlyZSgncGl4aS1zb3VuZCcpO1xyXG5cclxuXHJcbi8vIGdsb2JhbCB2YXJzXHJcbiAgICAvLyBzeXN0ZW1cclxuICAgIGNvbnN0IHJlbmRlcmVyOlBJWEkuV2ViR0xSZW5kZXJlciA9IG5ldyBQSVhJLldlYkdMUmVuZGVyZXIoMzAwMCwgMzAwMCk7XHJcbiAgICBjb25zdCBzdGFnZTpQSVhJLkNvbnRhaW5lciA9IG5ldyBQSVhJLkNvbnRhaW5lcigpO1xyXG4gICAgLy8gZ2FtZSBjb25zdGFudHNcclxuICAgIGNvbnN0IEhFTFBfT0ZGU0VUX1ggPSAxMDtcclxuICAgIGNvbnN0IEhFTFBfT0ZGU0VUX1kgPSAxMDtcclxuICAgIGNvbnN0IEJPQVJEX09GRlNFVF9YID0gMTA7XHJcbiAgICBjb25zdCBCT0FSRF9PRkZTRVRfWSA9IDcwO1xyXG4gICAgY29uc3QgQk9BUkRfUEFERElOR19YID0gNDtcclxuICAgIGNvbnN0IEJPQVJEX1BBRERJTkdfWSA9IDQ7XHJcbiAgICBjb25zdCBGUkFNRV9TUEVFRCA9IDIwMDtcclxuICAgIC8vIGdhbWUgcmVzb3VyY2VzXHJcbiAgICBsZXQgcmVzb3VyY2VzOmFueTtcclxuICAgIHZhciBmb250U3R5bGU7XHJcbiAgICB2YXIgYXJyb3dUZXh0dXJlcztcclxuICAgIHZhciBleHBsb3Npb25UZXh0dXJlcztcclxuICAgIHZhciBoZWxwVGV4dDtcclxuICAgIC8vIGdhbWUgc3RhdGVcclxuICAgIHZhciBib2FyZFNpemUgPSAxMDtcclxuICAgIHZhciBib2FyZCA9IFtdO1xyXG4gICAgdmFyIGNvaW47XHJcbiAgICB2YXIgZXhwbG9zaW9uO1xyXG4gICAgdmFyIGNvaW5UcmFpbCA9IFtdO1xyXG4gICAgdmFyIGZyYW1lVGltZSA9IDA7XHJcblxyXG5cclxuZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcclxuICAgIC8vIFN5c3RlbVxyXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci52aWV3KTtcclxuICAgIC8vIFRleHR1cmVzXHJcbiAgICBQSVhJLmxvYWRlclxyXG4gICAgICAgIC5hZGQoJ3RpbGUxJywgJ2ltYWdlcy90aWxlX2JsdWUucG5nJylcclxuICAgICAgICAuYWRkKCd0aWxlMicsICdpbWFnZXMvdGlsZV9ncmVlbi5wbmcnKVxyXG4gICAgICAgIC5hZGQoJ2Fycm93X3VwJywgJ2ltYWdlcy9hcnJvd191cC5wbmcnKVxyXG4gICAgICAgIC5hZGQoJ2Fycm93X3JpZ2h0JywgJ2ltYWdlcy9hcnJvd19yaWdodC5wbmcnKVxyXG4gICAgICAgIC5hZGQoJ2Fycm93X2Rvd24nLCAnaW1hZ2VzL2Fycm93X2Rvd24ucG5nJylcclxuICAgICAgICAuYWRkKCdhcnJvd19sZWZ0JywgJ2ltYWdlcy9hcnJvd19sZWZ0LnBuZycpXHJcbiAgICAgICAgLmFkZCgnZXhwbG9zaW9uXzEnLCAnaW1hZ2VzL2V4cGxvc2lvbl8xLnBuZycpXHJcbiAgICAgICAgLmFkZCgnZXhwbG9zaW9uXzInLCAnaW1hZ2VzL2V4cGxvc2lvbl8yLnBuZycpXHJcbiAgICAgICAgLmFkZCgnZXhwbG9zaW9uXzMnLCAnaW1hZ2VzL2V4cGxvc2lvbl8zLnBuZycpXHJcbiAgICAgICAgLmFkZCgnZXhwbG9zaW9uXzQnLCAnaW1hZ2VzL2V4cGxvc2lvbl80LnBuZycpXHJcbiAgICAgICAgLmFkZCgnZXhwbG9zaW9uXzUnLCAnaW1hZ2VzL2V4cGxvc2lvbl81LnBuZycpXHJcbiAgICAgICAgLmFkZCgnY29pbicsICAgICdpbWFnZXMvY29pbi5wbmcnKVxyXG4gICAgICAgIC5sb2FkKGZ1bmN0aW9uIChsb2FkZXI6UElYSS5sb2FkZXJzLkxvYWRlciwgbmV3UmVzb3VyY2VzOmFueSkge1xyXG4gICAgICAgICAgICByZXNvdXJjZXMgPSBuZXdSZXNvdXJjZXM7XHJcbiAgICAgICAgICAgIHNldHVwVGV4dHVyZVJlc291cmNlcygpO1xyXG4gICAgICAgICAgICBzZXR1cFVpKCk7XHJcbiAgICAgICAgICAgIHNldHVwQm9hcmQoKTtcclxuICAgICAgICAgICAgc2V0dXBDb2luQW5kRXhwbG9zaW9uKCk7XHJcbiAgICAgICAgICAgIHJ1bkFuaW1hdGlvbigwKTtcclxuICAgICAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0dXBUZXh0dXJlUmVzb3VyY2VzKCkge1xyXG4gICAgYXJyb3dUZXh0dXJlcyA9IFtdO1xyXG4gICAgYXJyb3dUZXh0dXJlc1swXSA9IHJlc291cmNlcy5hcnJvd191cC50ZXh0dXJlO1xyXG4gICAgYXJyb3dUZXh0dXJlc1sxXSA9IHJlc291cmNlcy5hcnJvd19yaWdodC50ZXh0dXJlO1xyXG4gICAgYXJyb3dUZXh0dXJlc1syXSA9IHJlc291cmNlcy5hcnJvd19kb3duLnRleHR1cmU7XHJcbiAgICBhcnJvd1RleHR1cmVzWzNdID0gcmVzb3VyY2VzLmFycm93X2xlZnQudGV4dHVyZTtcclxuICAgIGV4cGxvc2lvblRleHR1cmVzID0gW107XHJcbiAgICBleHBsb3Npb25UZXh0dXJlc1swXSA9IHJlc291cmNlcy5leHBsb3Npb25fMS50ZXh0dXJlO1xyXG4gICAgZXhwbG9zaW9uVGV4dHVyZXNbMV0gPSByZXNvdXJjZXMuZXhwbG9zaW9uXzIudGV4dHVyZTtcclxuICAgIGV4cGxvc2lvblRleHR1cmVzWzJdID0gcmVzb3VyY2VzLmV4cGxvc2lvbl8zLnRleHR1cmU7XHJcbiAgICBleHBsb3Npb25UZXh0dXJlc1szXSA9IHJlc291cmNlcy5leHBsb3Npb25fNC50ZXh0dXJlO1xyXG4gICAgZXhwbG9zaW9uVGV4dHVyZXNbNF0gPSByZXNvdXJjZXMuZXhwbG9zaW9uXzUudGV4dHVyZTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0dXBVaSgpIHtcclxuICAgIC8vIFNldHVwIHN0eWxlXHJcbiAgICBmb250U3R5bGUgPSBuZXcgUElYSS5UZXh0U3R5bGUoe1xyXG4gICAgICAgIGZvbnRGYW1pbHk6ICdBcmlhbCcsXHJcbiAgICAgICAgZm9udFNpemU6IDIwLFxyXG4gICAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICB9KTtcclxuICAgIC8vIFNldHVwIGhlbHAgdGV4dFxyXG4gICAgaGVscFRleHQgPSBuZXcgUElYSS5UZXh0KFwiQ2xpY2sgb24gYSB0aWxlIHRvIGRyb3AgYSBjb2luLlxcblNlZSBxdWlja2x5IHlvdSBjYW4gZmluZCB0aGUgcGF0aHMgb2ZmIG9mIHRoZSBib2FyZC5cIiwgZm9udFN0eWxlKTtcclxuICAgIGhlbHBUZXh0LnggPSBIRUxQX09GRlNFVF9YO1xyXG4gICAgaGVscFRleHQueSA9IEhFTFBfT0ZGU0VUX1k7XHJcbiAgICBzdGFnZS5hZGRDaGlsZChoZWxwVGV4dCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldHVwQm9hcmQoKSB7XHJcbiAgICAvLyBTZXR1cCBib2FyZCBzcHJpdGVzXHJcbiAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGJvYXJkU2l6ZTsgKyt5KSB7XHJcbiAgICAgICAgYm9hcmRbeV0gPSBbXTtcclxuICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IGJvYXJkU2l6ZTsgKyt4KSB7XHJcbiAgICAgICAgICAgIC8vIHRpbGVcclxuICAgICAgICAgICAgdmFyIHRpbGVUZXh0dXJlID0gKCh4ICsgeSkgJSAyID09IDApID8gcmVzb3VyY2VzLnRpbGUxLnRleHR1cmUgOiByZXNvdXJjZXMudGlsZTIudGV4dHVyZTtcclxuICAgICAgICAgICAgdmFyIHBvc2l0aW9uWCA9IHggKiAoNjQgKyBCT0FSRF9QQURESU5HX1gpICsgQk9BUkRfT0ZGU0VUX1g7XHJcbiAgICAgICAgICAgIHZhciBwb3NpdGlvblkgPSB5ICogKDY0ICsgQk9BUkRfUEFERElOR19ZKSArIEJPQVJEX09GRlNFVF9ZO1xyXG4gICAgICAgICAgICBib2FyZFt5XVt4XSA9IG5ldyBQSVhJLlNwcml0ZSh0aWxlVGV4dHVyZSk7XHJcbiAgICAgICAgICAgIHZhciB0aWxlID0gYm9hcmRbeV1beF07XHJcbiAgICAgICAgICAgIHRpbGUucG9zaXRpb24ueCA9IHBvc2l0aW9uWDtcclxuICAgICAgICAgICAgdGlsZS5wb3NpdGlvbi55ID0gcG9zaXRpb25ZO1xyXG4gICAgICAgICAgICBzdGFnZS5hZGRDaGlsZCh0aWxlKTtcclxuICAgICAgICAgICAgLy8gYXJyb3dcclxuICAgICAgICAgICAgdGlsZS5hcnJvdyA9IG5ldyBQSVhJLlNwcml0ZShhcnJvd1RleHR1cmVzWzJdKTtcclxuICAgICAgICAgICAgdGlsZS5hcnJvd1R5cGUgPSAyO1xyXG4gICAgICAgICAgICB0aWxlLmFkZENoaWxkKHRpbGUuYXJyb3cpO1xyXG4gICAgICAgICAgICAvLyBtb3VzZSBjbGlja3NcclxuICAgICAgICAgICAgdGlsZS5pbnRlcmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRpbGUuYnV0dG9uTW9kZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRpbGUub24oJ21vdXNldXAnLCBvbkJvYXJkQ2xpY2spO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIFNldHVwIG5laWdoYm9yIGxpbmtzXHJcbiAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGJvYXJkU2l6ZTsgKyt5KSB7XHJcbiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBib2FyZFNpemU7ICsreCkge1xyXG4gICAgICAgICAgICB2YXIgdGlsZSA9IGJvYXJkW3ldW3hdO1xyXG4gICAgICAgICAgICB0aWxlLm5laWdoYm9yID0gW107XHJcbiAgICAgICAgICAgIGlmICh5ID4gMCkgICAgICAgICAgIHsgdGlsZS5uZWlnaGJvclswXSA9IGJvYXJkW3ktMV1beF07IH1cclxuICAgICAgICAgICAgaWYgKHggPCBib2FyZFNpemUtMSkgeyB0aWxlLm5laWdoYm9yWzFdID0gYm9hcmRbeV1beCsxXTsgfVxyXG4gICAgICAgICAgICBpZiAoeSA8IGJvYXJkU2l6ZS0xKSB7IHRpbGUubmVpZ2hib3JbMl0gPSBib2FyZFt5KzFdW3hdOyB9XHJcbiAgICAgICAgICAgIGlmICh4ID4gMCkgICAgICAgICAgIHsgdGlsZS5uZWlnaGJvclszXSA9IGJvYXJkW3ldW3gtMV07IH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByYW5kb21pemVCb2FyZCgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZXR1cENvaW5BbmRFeHBsb3Npb24oKSB7XHJcbiAgICBjb2luID0gbmV3IFBJWEkuU3ByaXRlKHJlc291cmNlcy5jb2luLnRleHR1cmUpO1xyXG4gICAgY29pbi52aXNpYmxlID0gZmFsc2U7XHJcbiAgICBzdGFnZS5hZGRDaGlsZChjb2luKTtcclxuICAgIGV4cGxvc2lvbiA9IG5ldyBQSVhJLlNwcml0ZShleHBsb3Npb25UZXh0dXJlc1swXSk7XHJcbiAgICBleHBsb3Npb24uZnJhbWUgPSAtMTtcclxuICAgIGV4cGxvc2lvbi52aXNpYmxlID0gZmFsc2U7XHJcbiAgICBzdGFnZS5hZGRDaGlsZChleHBsb3Npb24pO1xyXG59XHJcblxyXG5mdW5jdGlvbiByYW5kb21pemVCb2FyZCgpIHtcclxuICAgIGZvciAodmFyIHkgPSAwOyB5IDwgYm9hcmRTaXplOyArK3kpIHtcclxuICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IGJvYXJkU2l6ZTsgKyt4KSB7XHJcbiAgICAgICAgICAgIHZhciB0eXBlID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNCk7XHJcbiAgICAgICAgICAgIGJvYXJkW3ldW3hdLmFycm93LnRleHR1cmUgPSBhcnJvd1RleHR1cmVzW3R5cGVdO1xyXG4gICAgICAgICAgICBib2FyZFt5XVt4XS5hcnJvd1R5cGUgPSB0eXBlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gb25Cb2FyZENsaWNrKGV2ZW50KSB7XHJcbiAgICB2YXIgdGlsZSA9IGV2ZW50LnRhcmdldDtcclxuICAgIC8vIHJlbW92ZSB0aGUgZXhwbG9zaW9uIChpZiBzdGlsbCB2aXNpYmxlKVxyXG4gICAgZXhwbG9zaW9uLnZpc2libGUgPSBmYWxzZTtcclxuICAgIC8vIHBsYWNlIHRoZSBjb2luXHJcbiAgICBjb2luLnRpbGUgPSB0aWxlOyBcclxuICAgIGNvaW4ucG9zaXRpb24gPSB0aWxlLnBvc2l0aW9uOyBcclxuICAgIGNvaW4udmlzaWJsZSA9IHRydWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJ1bkZyYW1lTG9naWMoKSB7XHJcbiAgICBpZiAoY29pbi52aXNpYmxlICYmICFleHBsb3Npb24udmlzaWJsZSkge1xyXG4gICAgICAgIHZhciB0aWxlID0gY29pbi50aWxlO1xyXG4gICAgICAgIC8vIGFkZCB0cmFpbFxyXG4gICAgICAgIHZhciBuZXdDb2luVHJhaWwgPSBuZXcgUElYSS5TcHJpdGUocmVzb3VyY2VzLmNvaW4udGV4dHVyZSk7XHJcbiAgICAgICAgY29pblRyYWlsLnB1c2gobmV3Q29pblRyYWlsKTtcclxuICAgICAgICBuZXdDb2luVHJhaWwucG9zaXRpb24gPSBjb2luLnBvc2l0aW9uO1xyXG4gICAgICAgIG5ld0NvaW5UcmFpbFtcInRpbGVcIl0gPSBjb2luLnRpbGU7XHJcbiAgICAgICAgbmV3Q29pblRyYWlsLmFscGhhID0gLjU7XHJcbiAgICAgICAgc3RhZ2UuYWRkQ2hpbGQobmV3Q29pblRyYWlsKTtcclxuICAgICAgICAvLyBHZXQgbmV3IHBvc2l0aW9uXHJcbiAgICAgICAgdmFyIG5ld1RpbGUgPSB0aWxlLm5laWdoYm9yW3RpbGUuYXJyb3dUeXBlXTtcclxuICAgICAgICAvLyBDaGVjayBmb3IgdHJhaWwgbG9vcFxyXG4gICAgICAgIGlmIChuZXdUaWxlKSB7XHJcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvaW5UcmFpbC5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICAgIGlmIChjb2luVHJhaWxbaV0udGlsZSA9PSBuZXdUaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgIGV4cGxvc2lvbi52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBSZW1vdmUgY29pbiAoaWYgYXBwbGljYWJsZSlcclxuICAgICAgICBpZiAoIW5ld1RpbGUgfHwgZXhwbG9zaW9uLnZpc2libGUpIHtcclxuICAgICAgICAgICAgd2hpbGUgKGNvaW5UcmFpbC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29pblRyYWlsSXRlbSA9IGNvaW5UcmFpbC5wb3AoKTtcclxuICAgICAgICAgICAgICAgIHN0YWdlLnJlbW92ZUNoaWxkKGNvaW5UcmFpbEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgY29pblRyYWlsSXRlbS5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFleHBsb3Npb24udmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgY29pbi52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAvLyBtb3ZlIGNvaW5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb2luLnRpbGUgPSBuZXdUaWxlO1xyXG4gICAgICAgICAgICBjb2luLnBvc2l0aW9uID0gbmV3VGlsZS5wb3NpdGlvbjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoZXhwbG9zaW9uLnZpc2libGUpIHtcclxuICAgICAgICArK2V4cGxvc2lvbi5mcmFtZTtcclxuICAgICAgICAvLyBzcGVjaWFsIGZyYW1lc1xyXG4gICAgICAgIGlmIChleHBsb3Npb24uZnJhbWUgPT0gMCkge1xyXG4gICAgICAgICAgZXhwbG9zaW9uLnBvc2l0aW9uID0gY29pbi5wb3NpdGlvbjtcclxuICAgICAgICB9IGVsc2UgaWYgKGV4cGxvc2lvbi5mcmFtZSA9PSAxKSB7XHJcbiAgICAgICAgICBjb2luLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRHJhdyBvciByZW1vdmVcclxuICAgICAgICBpZiAoZXhwbG9zaW9uLmZyYW1lID09IDUpIHtcclxuICAgICAgICAgICAgZXhwbG9zaW9uLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgZXhwbG9zaW9uLmZyYW1lID0gLTE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZXhwbG9zaW9uLnRleHR1cmUgPSBleHBsb3Npb25UZXh0dXJlc1tleHBsb3Npb24uZnJhbWVdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcnVuQW5pbWF0aW9uKHRpbWVTdGFtcCkge1xyXG4gICAgLy8gY2FsbCBcInJ1bkZyYW1lTG9naWMoKVwiIGF0IEZSQU1FX1NQRUVEIGludGVydmFsc1xyXG4gICAgaWYgKHRpbWVTdGFtcC1mcmFtZVRpbWUgPiBGUkFNRV9TUEVFRCkge1xyXG4gICAgICAgIGZyYW1lVGltZSA9IHRpbWVTdGFtcDtcclxuICAgICAgICBydW5GcmFtZUxvZ2ljKCk7XHJcbiAgICB9XHJcbiAgICAvLyBSZW5kZXIgYW5kIGxvb3BcclxuICAgIHJlbmRlcmVyLnJlbmRlcihzdGFnZSk7XHJcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocnVuQW5pbWF0aW9uKTtcclxufVxyXG5cclxuaW5pdGlhbGl6ZSgpO1xyXG4iXX0=
